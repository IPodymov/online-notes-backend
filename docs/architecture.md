# Архитектура проекта

Проект построен на основе принципов **Clean Architecture** и **SOLID**, обеспечивая масштабируемость, тестируемость и легкое обслуживание кода.

## Структура проекта

```
lib/
├── domain/                    # Ядро приложения (независимо от фреймворков)
│   ├── models/               # Бизнес-объекты
│   │   ├── user.dart         # Модель пользователя
│   │   └── note.dart         # Модель записки
│   └── repositories/          # Абстрактные интерфейсы
│       ├── user_repository.dart
│       └── note_repository.dart
│
├── data/                      # Реализация доступа к данным
│   └── repositories/          # Конкретные реализации репозиториев
│       ├── in_memory_user_repository.dart
│       └── in_memory_note_repository.dart
│
├── services/                  # Бизнес-логика приложения
│   ├── user_service.dart     # Логика управления пользователями
│   ├── note_service.dart     # Логика управления записками
│   └── auth_service.dart     # Аутентификация и авторизация
│
├── api/                       # Слой API (HTTP интерфейсы)
│   └── controllers/          # Обработчики HTTP-запросов
│       ├── user_controller.dart
│       └── note_controller.dart
│
└── utils/                     # Вспомогательные утилиты
    └── json_utils.dart       # Утилиты для работы с JSON

bin/
└── server.dart              # Точка входа приложения
```

## Слои архитектуры

### 1. Domain Layer (Слой бизнеса)

Центральный слой, содержащий бизнес-объекты и интерфейсы. Полностью независим от внешних фреймворков.

**Характеристики**:

- Не импортирует ничего из других слоев
- Не знает о Shelf, HTTP, базах данных
- Содержит чистую бизнес-логику

### 2. Data Layer (Слой данных)

Реализует интерфейсы из Domain Layer для работы с конкретными источниками данных.

**Характеристики**:

- Зависит от Domain Layer (реализует интерфейсы)
- Содержит логику работы с данными
- Легко заменяется на другую реализацию (например, MongoDB)

### 3. Services Layer (Слой бизнес-логики)

Реализует use cases приложения, используя репозитории.

**Характеристики**:

- Зависит только от абстракций (интерфейсов) Domain Layer
- Содержит основную бизнес-логику
- Не знает о HTTP или деталях хранилища

### 4. API Layer (Слой интерфейса)

Обрабатывает HTTP-запросы и маршрутизирует их.

**Характеристики**:

- Зависит от Services Layer
- Преобразует HTTP-запросы в вызовы сервисов
- Обрабатывает исключения и преобразует в HTTP-ответы

## Принципы SOLID

### Single Responsibility Principle (SRP)

Каждый класс выполняет одну задачу:

- `UserController` - только обработка HTTP-запросов пользователей
- `UserService` - только бизнес-логика пользователей
- `InMemoryUserRepository` - только доступ к данным

### Open/Closed Principle (OCP)

Код открыт для расширения, но закрыт для модификации:

- Чтобы добавить новое хранилище (например, PostgreSQL), создаем новую реализацию репозитория
- Сервисы не требуют изменений

### Dependency Inversion Principle (DIP)

Зависимости указывают на абстракции, не на конкретные реализации:

```dart
// ✅ Хорошо (зависимость на абстракцию)
class UserService {
  final UserRepository repository;
}
```

## Используемые технологии

| Технология             | Назначение                               |
| ---------------------- | ---------------------------------------- |
| **Dart SDK**           | Язык программирования                    |
| **Shelf**              | Модульный веб-сервер                     |
| **Shelf Router**       | Маршрутизация HTTP-запросов              |
| **JSON Serializable**  | Генерирует код для (de)сериализации JSON |
| **UUID**               | Генерация уникальных идентификаторов     |
| **Shelf CORS Headers** | Поддержка CORS                           |
| **Dotenv**             | Загрузка переменных окружения            |

## Инициализация приложения

1. **Загрузка конфигурации** из `.env` файла
2. **Инициализация Data Layer** - создание репозиториев
3. **Инициализация Services Layer** - создание сервисов с внедрением зависимостей
4. **Инициализация API Layer** - создание контроллеров с внедрением зависимостей
5. **Регистрация маршрутов** в роутере
6. **Запуск сервера** на указанном порту

## Расширяемость

### Добавление нового функционала

1. Добавить модель в `domain/models/`
2. Создать интерфейс репозитория в `domain/repositories/`
3. Реализовать репозиторий в `data/repositories/`
4. Создать сервис в `services/`
5. Создать контроллер в `api/controllers/`
6. Зарегистрировать маршруты в `server.dart`

### Смена хранилища данных

Текущая реализация использует хранилище в памяти. Чтобы перейти на MongoDB или другую БД, необходимо создать новый класс репозитория, реализующий интерфейсы, и обновить инициализацию в `server.dart`. Остальной код не требует изменений.
